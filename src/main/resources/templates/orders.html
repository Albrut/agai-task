<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management System</title>
    <link rel="stylesheet" th:href="@{/css/orders.css}">
</head>
<body>
<div class="card-container">
    <h1>Order Management System</h1>

    <table class="table">
        <thead>
        <tr>
            <th>Order ID</th>
            <th>Owner</th>
            <th>Total ($)</th>
            <th>Delivery Address</th>
            <th>Delivery Status</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="order : ${orders}">
            <td th:text="${order.id}"></td>
            <td th:text="${order.usernameOfOwner}"></td>
            <td th:text="${order.totalAmount}"></td>
            <td>
                <div th:if="${order.deliveryAddress}">
                    <span th:text="${order.deliveryAddress}"></span>
                </div>
                <div th:unless="${order.deliveryAddress}">
                    <span class="delivery-placeholder">N/A</span>
                </div>
            </td>
            <td>
                <div th:class="${order.isDelivered} ? 'status-badge delivered' : 'status-badge pending'">
                    <span th:text="${order.isDelivered} ? 'Delivered' : 'In Transit'"></span>
                </div>
            </td>
            <td class="actions">
                <a th:href="@{/admin/orders/{id}(id=${order.id})}" class="action-btn btn-view">Details</a>
                <a th:href="@{/admin/orders/edit/{id}(id=${order.id})}" class="action-btn btn-edit">Edit</a>
                <button th:attr="onclick='showDeleteModal(\'' + ${order.id} + '\')'" class="action-btn btn-delete">
                    Delete
                </button>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="modal-overlay" id="modalContainer">
        <div class="modal">
            <p>Are you sure you want to delete this order?</p>
            <div class="delete-confirmation">
                <button class="cancel-btn" onclick="hideModal()">CANCEL</button>
                <button class="confirm-btn" onclick="confirmDelete()">DELETE</button>
            </div>
            <form id="deleteForm" th:action="@{/admin/orders/delete/{id}(id='UUID_PLACEHOLDER')}" method="post">
                <input type="hidden" name="_method" value="POST">
            </form>
        </div>
    </div>
</div>

<script>
    let currentDeleteId;

    function showDeleteModal(orderId) {
        currentDeleteId = orderId.toString();
        document.getElementById('modalContainer').style.display = 'flex';
    }

    function hideModal() {
        document.getElementById('modalContainer').style.display = 'none';
    }

    function confirmDelete() {
        const form = document.getElementById('deleteForm');
        form.action = `/admin/orders/delete/${currentDeleteId}`;
        form.submit();
    }

    document.querySelector('.modal-overlay').addEventListener('click', (e) => {
        if (e.target === e.currentTarget) hideModal();
    });
</script>
</body>
</html>
